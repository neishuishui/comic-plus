<template>
  <div class="cu-menu" :style="style" @mouseleave="showActiveBox = false">
    <slot></slot>
    <Transition name="cu-fade">
      <span class="cu-menu-activebox" v-show="showActiveBox" :style="{ transform: `translateY(${top}px)` }"></span>
    </Transition>
  </div>
</template>

<script setup lang="ts">
import { computed, provide, ref } from 'vue';
import '../style/css';
import { menuProps, menuEmits } from './main.props';
defineOptions({
  name: 'CuMenu'
});
const props = defineProps(menuProps);
const emit = defineEmits(menuEmits);

const top = ref(0);
const showActiveBox = ref(false);

const style = computed(() => {
  return {
    width: props.width,
    height: props.height
  };
});

function setActiveboxTop(t: number) {
  top.value = t;
  if (!showActiveBox.value) {
    showActiveBox.value = true;
  }
}
function useItemClick(name: string | number) {
  emit('menu-click', name);
  emit('update:modelValue', name);
}

const provideValue = computed(() => {
  return props.modelValue;
});
const provideEllipsis = computed(() => {
  return props.showEllipsis;
});

provide('setActiveboxTop', setActiveboxTop);
provide('useItemClick', useItemClick);
provide('showEllipsis', provideEllipsis);
provide('activeValue', provideValue);
</script>
