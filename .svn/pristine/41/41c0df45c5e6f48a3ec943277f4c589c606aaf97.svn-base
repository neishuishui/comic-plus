<template>
  <span class="cu-avatar" :class="shape" :style="avatarStyle">
    <img :src="src" v-if="src" :style="{ 'object-fit': fit }" />
    <template v-else-if="$slots.default">
      <slot></slot>
    </template>
    <i class="cu-icon-user-s avatar-icon" v-else></i>
  </span>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue';
import '../style/avatar.css';
import { avatarProps } from './main.props';
defineOptions({
  name: 'CuAvatar'
});

const props = defineProps(avatarProps);

const avatarStyle = computed(() => {
  return {
    width: props.size + 'px',
    height: props.size + 'px',
    fontSize: props.size / 3 + 'px',
    backgroundColor: backgroundColor.value
  };
});

const backgroundColor = computed(() => {
  if (!props.color) return undefined;
  if (props.color === 'random') return randomColor();
  return props.color;
});

function randomColor() {
  const r = Math.floor(Math.random() * 256);
  const g = Math.floor(Math.random() * 256);
  const b = Math.floor(Math.random() * 256);
  const hexR = r.toString(16).padStart(2, '0');
  const hexG = g.toString(16).padStart(2, '0');
  const hexB = b.toString(16).padStart(2, '0');
  const hexColor = `#${hexR}${hexG}${hexB}`;
  return hexColor;
}
</script>

<style scoped></style>
