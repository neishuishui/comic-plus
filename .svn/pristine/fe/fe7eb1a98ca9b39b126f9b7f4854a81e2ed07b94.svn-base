<template>
  <div class="cu-tabs" :class="type" :style="{ '--color': color }">
    <i class="left cu-icon-left" @click="scrollTo(-200)" v-if="haveScroll"></i>
    <i class="right cu-icon-right" @click="scrollTo(200)" v-if="haveScroll"></i>
    <cu-scroll-bar ref="scrollBarRef" @scroll="onScroll">
      <div class="cu-tabs__list" ref="tabList">
        <slot></slot>
      </div>
    </cu-scroll-bar>
  </div>
</template>

<script setup lang="ts">
import { provide, computed, ref } from 'vue';
import '../style/tab.css';
import { CuScrollBar } from '../../scroll-bar';
import { tabProps } from './main.props';
import { TABS_PROVIDE } from './type';
defineOptions({
  name: 'CuTabs'
});
const props = defineProps(tabProps);

const tabList = ref();
const scrollBarRef = ref();
const recoreScroll = ref(0);

const haveScroll = computed(() => {
  if (!scrollBarRef.value) return;
  return scrollBarRef.value.showThumbx;
});

const emit = defineEmits(['update:modelValue', 'change']);

function itemClick(name: string | number) {
  emit('update:modelValue', name);
  emit('change', name);
}

function scrollTo(left: number) {
  scrollBarRef.value.setBarLeft(recoreScroll.value + left);
}

function onScroll(e) {
  recoreScroll.value = e.target.scrollLeft;
}

provide(TABS_PROVIDE, {
  props,
  itemClick
});
</script>
