<template>
  <div class="cu-collapse" :class="{ background }">
    <slot></slot>
  </div>
</template>

<script setup lang="ts">
import { ref, provide } from 'vue';
import '../style/collapse.css';
import { collapseProps, collapseEmits } from './main.props';

defineOptions({
  name: 'CuCollapse'
});

const props = defineProps(collapseProps);
const emit = defineEmits(collapseEmits);

const activeValue = ref(props.modelValue);

const collapseChange = function (val: boolean, name: string) {
  if (props.accordion) {
    activeValue.value = val ? name : '';
    updateValue();
    return;
  }
  let flag = activeValue.value.includes(name);
  if (val) {
    !flag && activeValue.value.push(name);
  } else {
    flag &&
      activeValue.value.splice(
        activeValue.value.findIndex((v: string) => v === name),
        1
      );
  }
  updateValue();
};
function updateValue() {
  emit('update:modelValue', activeValue.value);
  emit('change', activeValue.value);
}

provide('collapse:parent', {
  activeValue,
  props,
  collapseChange
});
</script>
