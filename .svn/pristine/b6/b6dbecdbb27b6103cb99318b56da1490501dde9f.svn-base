<template>
  <span class="cu-checkbox-group">
    <slot></slot>
  </span>
</template>

<script setup lang="ts">
import { provide, ref } from 'vue';
import '../style/css';
import useItemValidate from '../../utils/mixin/validate.js';
import { checkboxGroupProps, checkboxGroupEmits } from './group.props';
defineOptions({
  name: 'CuCheckboxGroup'
});

const props = defineProps(checkboxGroupProps);
const emit = defineEmits(checkboxGroupEmits);

const { itemValidate } = useItemValidate();

const activeValue = ref<string[] | number[]>(props.modelValue);

function changeItemCheck(val: boolean, label: string | number) {
  if (val) {
    activeValue.value.push(label);
  } else {
    activeValue.value.splice(
      activeValue.value.findIndex((v: string | number) => v === label),
      1
    );
  }
  emit('update:modelValue', activeValue.value);
  emit('change', activeValue.value);
  itemValidate('change');
}

provide('checkbox:parent', {
  activeValue,
  changeItemCheck
});
</script>
