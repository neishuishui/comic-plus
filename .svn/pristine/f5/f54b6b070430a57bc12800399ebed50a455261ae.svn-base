<template>
  <span class="cu-checkbox-group">
    <slot></slot>
  </span>
</template>

<script setup lang="ts">
import { provide, ref } from 'vue';
import { CHECKBOXGROUP_PROVIDE } from './type';
import { useItemValidate } from '../../../utils';
import { checkboxGroupProps, checkboxGroupEmits } from './group.props';
defineOptions({
  name: 'CuCheckboxGroup'
});

const props = defineProps(checkboxGroupProps);
const emit = defineEmits(checkboxGroupEmits);

const { itemValidate } = useItemValidate();

const activeValue = ref<string[]>(props.modelValue);

function changeItemCheck(val: boolean, label: string) {
  if (val) {
    activeValue.value.push(label);
  } else {
    activeValue.value.splice(
      activeValue.value.findIndex((v: string) => v === label),
      1
    );
  }
  emit('update:modelValue', activeValue.value);
  emit('change', activeValue.value);
  itemValidate('change');
}

provide(CHECKBOXGROUP_PROVIDE, {
  activeValue,
  changeItemCheck
});
</script>
