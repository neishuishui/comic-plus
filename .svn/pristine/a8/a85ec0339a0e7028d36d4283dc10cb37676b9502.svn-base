<template>
  <transition name="cu-fade" @after-enter="closed">
    <div class="cu-loading" :class="{ blur }" v-show="visible" :style="style">
      <i :class="icon"></i>
      <span v-if="text" class="cu-loading__text">{{ text }}</span>
    </div>
  </transition>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, nextTick } from 'vue';
import '../style/css';
import { getMaxZIndex } from '../../utils/tools';
import { loadingProps } from './main.props';
defineOptions({
  name: 'CuLoading'
});

const props = defineProps(loadingProps);

const visible = ref(false);

const style = computed(() => {
  const parentEl: HTMLElement = props.target || document.body;
  return {
    'z-index': getMaxZIndex(parentEl),
    background: props.background,
    color: props.color
  };
});

function updateVisible(val: boolean) {
  visible.value = val;
}

function closed() {}

defineExpose({
  visible,
  updateVisible
});

onMounted(() => {
  const parentEl: HTMLElement = props.target || document.body;
  const position = window.getComputedStyle(parentEl).position;
  if (position === 'static') {
    parentEl.style.setProperty('position', 'relative');
  }
  nextTick(() => {
    visible.value = props.visible;
  });
});
</script>
