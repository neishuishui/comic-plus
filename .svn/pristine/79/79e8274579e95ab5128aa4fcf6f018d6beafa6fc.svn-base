<template>
  <button
    class="cu-button"
    :class="[type, currentSize, { 'is-plain': plain }, { circle, round }]"
    :disabled="disabled"
    @click="$emit('click', $event)"
    :style="buttonStyle">
    <span v-if="icon" :class="icon" :style="{ marginRight: $slots.default ? '4px' : '0' }"></span>
    <span>
      <slot></slot>
    </span>
  </button>
</template>

<script setup lang="ts">
import { inject, computed } from 'vue';
import '../style/button.css';
import { FORM_PROVIDE } from '../../form/src/type';
import { buttonProps, buttonEmits } from './main.props';
import { useConfig, colorToRgba, colorBlend } from '../../../utils';

defineOptions({
  name: 'CuButton'
});

const props = defineProps(buttonProps);
const emit = defineEmits(buttonEmits);

const { SIZE, IS_COMIC } = useConfig();
const form = inject(FORM_PROVIDE, undefined);

const currentSize = computed(() => {
  return props.size ?? form?.props.size ?? SIZE?.value;
});

const buttonStyle = computed(() => {
  if (props.color) {
    if (props.plain) {
      return {
        '--cu-button-border-hover': IS_COMIC?.value ? undefined : props.color,
        borderColor: IS_COMIC?.value ? undefined : props.color,
        '--cu-button-background-hover': colorBlend(colorToRgba(props.color), 20),
        color: props.color
      };
    } else {
      return {
        backgroundColor: props.color,
        '--cu-button-border-hover': IS_COMIC?.value ? undefined : colorBlend(colorToRgba(props.color), 80),
        borderColor: IS_COMIC?.value ? undefined : props.color,
        '--cu-button-background-hover': colorBlend(colorToRgba(props.color), 80),
        color: '#fff'
      };
    }
  }
  return undefined;
});
</script>
