import { ref, watch } from 'vue';

export function usePopup(props: any, emit?: any) {
  const visible = ref(false);
  const showMode = ref(false);

  watch(
    () => props.modelValue,
    (val) => {
      if (val) {
        showMode.value = true;
      } else {
        visible.value = false;
      }
    }
  );

  function onAfterEnter() {
    visible.value = true;
  }

  function modeHandleClick() {
    if (!props.modeClose) return;
    close();
  }

  function close() {
    if (typeof props.beforeClose === 'function') {
      props.beforeClose(done);
    } else {
      done();
    }
  }
  function done() {
    visible.value = false;
  }

  function onAfterLeave() {
    showMode.value = false;
    emit?.('update:modelValue', false);
  }

  return {
    visible,
    showMode,
    onAfterEnter,
    modeHandleClick,
    onAfterLeave,
    close
  };
}
