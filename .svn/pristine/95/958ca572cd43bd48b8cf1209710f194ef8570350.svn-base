<template>
  <div
    class="cu-menu-item"
    @mouseenter="mouseenter"
    @click="itemClick"
    :show-title="showTitle && parent?.props.showEllipsis"
    v-title="label"
    :class="{ 'is-active': isActive }"
    ref="cuMenuItem"
  >
    <span v-if="icon" :class="icon" class="icon"></span>
    <span>
      <slot>{{ label }}</slot>
    </span>
  </div>
</template>

<script setup lang="ts">
import { inject, computed, ref, onMounted, onUpdated } from 'vue';
import '../style/css';
import { useTitle } from '../../utils/directive.js';
import { menuItemProps } from './item.props';
import type { menuProvide } from './type';
defineOptions({
  name: 'CuMenuItem'
});
const props = defineProps(menuItemProps);

const vTitle = useTitle();
const cuMenuItem = ref();
const showTitle = ref(false);

onMounted(() => {
  useShowTitle();
});
onUpdated(() => {
  useShowTitle();
});

const parent = inject<menuProvide>('menu:parent');

const isActive = computed(() => {
  if (parent?.props.modelValue) {
    return parent.props.modelValue == props.index;
  }
  return false;
});

function useShowTitle() {
  if (cuMenuItem.value.clientWidth < cuMenuItem.value.scrollWidth) {
    showTitle.value = true;
  }
}
function mouseenter(e: MouseEvent) {
  parent && parent.setActiveboxTop((<HTMLElement>e.target).offsetTop);
}
function itemClick() {
  parent && parent.useItemClick(props.index);
}
</script>
