<template>
  <ScrollBar :width="width" :height="height" v-if="width || height">
    <div class="cu-menu" @mouseleave="showActiveBox = false">
      <slot></slot>
      <Transition name="cu-fade">
        <span class="cu-menu-activebox" v-show="showActiveBox" :style="{ transform: `translateY(${top}px)` }"></span>
      </Transition>
    </div>
  </ScrollBar>
  <div class="cu-menu" @mouseleave="showActiveBox = false" v-else>
    <slot></slot>
    <Transition name="cu-fade">
      <span class="cu-menu-activebox" v-show="showActiveBox" :style="{ transform: `translateY(${top}px)` }"></span>
    </Transition>
  </div>
</template>

<script setup lang="ts">
import { computed, provide, ref } from 'vue';
import '../style/css';
import ScrollBar from '../../scroll-bar';
import { menuProps, menuEmits } from './main.props';
defineOptions({
  name: 'CuMenu'
});
const props = defineProps(menuProps);
const emit = defineEmits(menuEmits);

const top = ref(0);
const showActiveBox = ref(false);

function setActiveboxTop(t: number) {
  top.value = t;
  if (!showActiveBox.value) {
    showActiveBox.value = true;
  }
}
function useItemClick(name: string | number) {
  emit('menu-click', name);
  emit('update:modelValue', name);
}

provide('menu:parent', {
  props,
  setActiveboxTop,
  useItemClick
});
</script>
