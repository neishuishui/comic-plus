<template>
  <div class="cu-collapse" :class="{ background }">
    <slot></slot>
  </div>
</template>

<script setup lang="ts">
import { ref, provide } from 'vue';
import '../style/collapse.css';
import { COLLAPSE_PROVIDE } from './type';
import { collapseProps, collapseEmits } from './main.props';

defineOptions({
  name: 'CuCollapse'
});

const props = defineProps(collapseProps);
const emit = defineEmits(collapseEmits);

const activeValue = ref(props.modelValue);

function collapseChange(show: boolean, name: string) {
  if (props.accordion) {
    activeValue.value = show ? name : '';
    updateValue();
    return;
  }
  let flag = activeValue.value.includes(name);
  if (show) {
    !flag && activeValue.value.push(name);
  } else {
    flag &&
      activeValue.value.splice(
        activeValue.value.findIndex((v: string) => v === name),
        1
      );
  }
  updateValue();
}
function updateValue() {
  emit('update:modelValue', activeValue.value);
  emit('change', activeValue.value);
}

provide(COLLAPSE_PROVIDE, {
  activeValue,
  props,
  collapseChange
});
</script>
